<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Day 5 - Audio Upload</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Segoe UI", sans-serif;
    }

    body {
      background: linear-gradient(145deg, #0f2027, #203a43, #2c5364);
      color: white;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 40px 20px;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 30px;
      text-align: center;
    }

    .buttons {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    button {
      padding: 12px 24px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
      background: #00c6ff;
      background: linear-gradient(to right, #0072ff, #00c6ff);
      color: white;
      font-weight: 600;
    }

    button:hover {
      filter: brightness(1.2);
    }

    button:disabled {
      background: #555;
      cursor: not-allowed;
    }

    #status {
      margin-top: 20px;
      font-size: 1.1rem;
      font-weight: bold;
      background: rgba(255, 255, 255, 0.1);
      padding: 12px 20px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      max-width: 90vw;
      word-break: break-all;
      text-align: center;
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.5rem;
      }

      .buttons {
        flex-direction: column;
        gap: 10px;
      }

      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <h1>üéôÔ∏è Day 5: Record & Upload Your Voice</h1>
  <div class="buttons">
    <button id="startBtn">Start Recording</button>
    <button id="stopBtn" disabled>Stop & Upload</button>
  </div>
  <div id="status">Status: Waiting for input...</div>

  <script>
    let mediaRecorder;
    let audioChunks = [];

    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const status = document.getElementById("status");

    startBtn.onclick = async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];

        mediaRecorder.ondataavailable = e => {
          if (e.data.size > 0) {
            audioChunks.push(e.data);
          }
        };

        mediaRecorder.onstop = async () => {
          const blob = new Blob(audioChunks, { type: "audio/webm" });
          const filename = `recording_${Date.now()}.webm`;
          const formData = new FormData();
          formData.append("file", blob, filename);

          status.textContent = "Uploading...";

          try {
            const response = await fetch("http://localhost:8000/upload-audio/", {
              method: "POST",
              body: formData,
            });

            const result = await response.json();
            status.innerHTML = `‚úÖ Uploaded: <b>${result.filename}</b><br>üì¶ Type: ${result.content_type}<br>üóÇÔ∏è Size: ${result.size} bytes`;
          } catch (err) {
            status.textContent = "‚ùå Upload failed. Check console.";
            console.error(err);
          }
        };

        mediaRecorder.start();
        startBtn.disabled = true;
        stopBtn.disabled = false;
        status.textContent = "üé§ Recording...";
      } catch (err) {
        status.textContent = "‚ùå Microphone access denied.";
        console.error(err);
      }
    };

    stopBtn.onclick = () => {
      mediaRecorder.stop();
      startBtn.disabled = false;
      stopBtn.disabled = true;
    };
  </script>
</body>
</html>
